<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Khalk Store</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
<!-- Firebase SDK v8 импортууд - Realtime Database-ийг нэмсэн -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script> <!-- Realtime Database SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
<style>
body {margin:0; padding:0; font-family:Arial,sans-serif; background:#111; color:#eee;}
header {
  padding:15px; 
  display:flex; 
  align-items:center; 
  justify-content:space-between; 
  border-bottom:1px solid #222;
  opacity: 0;
  transform: rotateY(90deg);
  animation: rotateIn 0.5s ease forwards;
  position: relative; /* For current-page-display positioning */
}
header img.logo{width:40px;height:40px;cursor:pointer;}
header .logo-container {
  display:flex; 
  flex-direction: column; /* Зураг болон текстийг босоо байрлуулах */
  align-items:center; 
  gap: 2px; /* Зураг болон текстийн хоорондох зай */
}
header .logo-text {font-family: 'Cinzel', serif; font-size:18px; font-weight:700; color:#fff; text-transform:uppercase;}
header .menu-text { /* "Menu" текстэнд зориулсан CSS */
  font-size: 10px; /* Жижиг хэмжээ */
  color: #ccc; /* Бүдэг өнгө */
  margin-top: -5px; /* Зурагтай ойртуулах */
}
header .cart-container { /* Сагсны дүрс болон тоолуурыг багтаах */
  position: relative;
  cursor: pointer;
}
header img.cart{width:28px;height:28px;}
.cart-count { /* Сагсны тоолуурын CSS */
  position: absolute;
  top: -5px;
  right: -5px;
  background-color: #ff4d4d; /* Улаан өнгө */
  color: white;
  border-radius: 50%;
  padding: 2px 6px;
  font-size: 10px;
  font-weight: bold;
  min-width: 18px; /* Тоо нэмэгдэхэд хэлбэрээ хадгалах */
  text-align: center;
  line-height: 14px; /* Босоо тэгшлэх */
  display: none; /* Эхлээд нууцлагдсан байна */
}

/* Current Page Display */
#current-page-display {
  position: absolute;
  top: 15px; /* Header-ын доор байрлуулах */
  left: 50%;
  transform: translateX(-50%);
  font-size: 14px;
  color: #fff;
  font-weight: bold;
  text-transform: uppercase;
  padding: 5px 10px;
  background: rgba(0,0,0,0.5);
  border-radius: 5px;
  z-index: 500; /* Header-ын доор, бусад зүйлсийн дээр */
}


/* Products grid like Shopify */
.products {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(160px,1fr));
  gap:20px;
  padding:20px;
}
.product {
  background:#1c1c1c; 
  border-radius:12px; 
  padding:10px; 
  text-align:center; 
  position:relative; 
  cursor:pointer; 
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  overflow:hidden;
  opacity: 0;
  transform: translateY(20px);
  animation: productFadeIn 0.5s ease forwards;
}
.product:nth-child(1) {animation-delay: 0.1s;}
.product:nth-child(2) {animation-delay: 0.2s;}
.product:nth-child(3) {animation-delay: 0.3s;}
.product:nth-child(4) {animation-delay: 0.4s;}
.product:nth-child(5) {animation-delay: 0.5s;}
.product img {
  width:100%; 
  border-radius:12px; 
  transition: transform 0.3s ease;
}
.product:hover img {
  transform: scale(1.1);
}
.price {margin-top:8px; font-size:14px;}
.old-price{text-decoration:line-through;color:#999;margin-left:4px;}
button {
  padding:6px 12px; 
  border:none; 
  border-radius:8px; 
  background:#007bff; 
  color:#fff; 
  font-size:13px; 
  cursor:pointer; 
  margin-top:6px;
  transition: transform 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
  outline: none;
}
button:hover {
  background:#0056b3; 
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0,123,255,0.3);
}
button:focus {
  outline: none;
  box-shadow: 0 0 8px rgba(0,123,255,0.5);
}

.page {
  display:none;
  opacity: 0;
  transform: rotateY(90deg);
  animation: rotateIn 0.5s ease forwards;
}
.page.active {display:block;}

/* Cart */
.cart-page{padding:20px;}
.cart-item{background:#1c1c1c; border-radius:12px; padding:10px; margin-bottom:10px; display:flex; align-items:center; gap:10px; position:relative; animation:slideIn 0.5s ease forwards;}
.cart-item img{width:50px;border-radius:6px;}
.cart-empty{text-align:center;margin-top:50px;color:#888;font-size:16px;}
.cart-item .delete-btn{
  position:absolute; right:-50px; top:50%; transform:translateY(-50%); width:28px; height:28px;
  opacity:0; transition: all 0.3s ease;
}
.cart-item:hover{border:2px solid #007bff;}
.cart-item:hover .delete-btn{right:10px; opacity:1;}

/* Slide in for cart items */
@keyframes slideIn {from {opacity:0; transform:translateX(-50px);} to {opacity:1; transform:translateX(0);}}

/* Product fade-in animation */
@keyframes productFadeIn {
  from {opacity: 0; transform: translateY(20px);}
  to {opacity: 1; transform: translateY(0);}
}

/* Rotate-in animation for initial load */
@keyframes rotateIn {
  from {opacity: 0; transform: rotateY(90deg);}
  to {opacity: 1; transform: rotateY(0);}
}

/* Notification panel */
#notify {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #1c1c1c;
  border: 2px solid #28a745;
  color: #fff;
  padding: 12px 24px;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 600;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  display: none;
  z-index: 1000;
  width: 300px;
  text-align: center;
}

@keyframes notifyIn {0% {opacity:0; transform:translate(-50%, -50px);} 100% {opacity:1; transform:translate(-50%, 0);}}
@keyframes notifyOut {0% {opacity:1; transform:translate(-50%, 0);} 100% {opacity:0; transform:translate(-50%, -50px);}}

/* Add-to-cart button panel */
.product-panel {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  display: none;
  gap: 8px;
  opacity: 0;
  transition: opacity 0.3s ease, transform 0.3s ease;
}
.product:hover .product-panel {
  display: flex;
  opacity: 1;
  transform: translateX(-50%) scale(1);
  animation: panelIn 0.3s ease forwards;
}
.product-panel button {
  font-size: 12px;
  padding: 6px 12px;
  border-radius: 8px;
  border: none;
  color: #fff;
  font-weight: 500;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
  outline: none;
}
.product-panel button:nth-child(1) {
  background: #1c1c1c;
  border: 2px solid #ff4d4d;
}
.product-panel button:nth-child(1):hover {
  transform: scale(1.1);
  box-shadow: 0 2px 8px rgba(255,0,0,0.3);
  opacity: 0.9;
}
.product-panel button:nth-child(1):focus {
  outline: none;
  box-shadow: 0 0 8px rgba(255,0,0,0.5);
}
.product-panel button:nth-child(2) {
  background: linear-gradient(45deg, #ff4d4d, #ff1a1a);
}
.product-panel button:nth-child(2):hover {
  transform: scale(1.1);
  box-shadow: 0 2px 8px rgba(255,0,0,0.3);
  opacity: 0.9;
}
.product-panel button:nth-child(2):focus {
  outline: none;
  box-shadow: 0 0 8px rgba(255,0,0,0.5);
}

/* Panel in/out animations */
@keyframes panelIn {
  from {opacity: 0; transform: translateX(-50%) scale(0.8);}
  to {opacity: 1; transform: translateX(-50%) scale(1);}
}

/* Code modal */
#codeModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 2000;
  justify-content: center;
  align-items: center;
}
.code-modal-content {
  background: #1c1c1c;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  width: 300px;
  color: #fff;
}
.code-modal-content h3 {
  margin: 0 0 10px;
}
.code-modal-content p {
  font-size: 18px;
  font-weight: bold;
  color: #ff4d4d;
}
.code-modal-content button {
  background: #ff4d4d;
  padding: 10px 20px;
  border-radius: 8px;
}

/* Sidebar */
#sidebar {
  position: fixed;
  top: 0;
  left: -350px;
  width: 300px;
  height: 100%;
  background: #1c1c1c;
  z-index: 1500;
  transition: left 0.3s ease;
  padding: 20px;
  box-shadow: 2px 0 10px rgba(0,0,0,0.5);
}
#sidebar.active {
  left: 0;
}
#sidebar ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
#sidebar li {
  padding: 15px;
  font-size: 18px;
  color: #fff;
  cursor: pointer;
  transition: background 0.2s ease;
  display: flex; /* Зургийг зэрэгцүүлэхийн тулд нэмсэн */
  align-items: center; /* Зургийг төвлөрүүлэхийн тулд нэмсэн */
  gap: 10px; /* Зураг болон текстийн хоорондох зайг нэмсэн */
}
#sidebar li img { /* Нэмэгдсэн CSS */
  width: 24px; /* Зургийн хэмжээ */
  height: 24px; /* Зургийн хэмжээ */
  vertical-align: middle; /* Тексттэй зэрэгцүүлэх */
}
#sidebar li:hover {
  background: #ff4d4d;
  border-radius: 8px;
}
#sidebar .close-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  font-size: 24px;
  color: #fff;
  cursor: pointer;
}

/* Sidebar animations */
@keyframes sidebarIn {
  from {left: -350px;}
  to {left: 0;}
}
@keyframes sidebarOut {
  from {left: 0;}
  to {left: -350px;}
}

/* Address Page Styles */
.address-form-container {
  background: #1c1c1c;
  border-radius: 12px;
  padding: 20px;
  margin: 20px auto;
  max-width: 500px;
  color: #eee;
}
.address-form-container h2 {
  text-align: center;
  margin-bottom: 20px;
  color: #fff;
}
.address-form-container .form-group {
  margin-bottom: 15px;
}
.address-form-container label {
  display: block;
  margin-bottom: 5px;
  font-size: 14px;
  color: #ccc;
}
.address-form-container input[type="text"],
.address-form-container input[type="tel"] {
  width: calc(100% - 20px);
  padding: 10px;
  border: 1px solid #333;
  border-radius: 8px;
  background: #222;
  color: #fff;
  font-size: 16px;
}
.address-form-container input[type="text"]:focus,
.address-form-container input[type="tel"]:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 5px rgba(0,123,255,0.5);
}
.address-form-container button[type="submit"] {
  width: 100%;
  padding: 12px;
  background: #007bff;
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.3s ease, transform 0.2s ease;
}
.address-form-container button[type="submit"]:hover {
  background: #0056b3;
  transform: translateY(-2px);
}
</style>
</head>
<body>

<header>
  <div class="logo-container">
    <img src="assets/khalk.png" class="logo" alt="Logo" onclick="toggleSidebar()">
    <span class="menu-text">Menu</span> <!-- "Menu" текст нэмсэн -->
  </div>
  <div class="cart-container" onclick="openCart()"> <!-- Сагсны дүрс болон тоолуурыг багтаах div -->
    <img src="assets/cart.png" class="cart" alt="Cart">
    <span class="cart-count" id="cartCount">0</span> <!-- Сагсны тоолуур нэмсэн -->
  </div>
  <div id="current-page-display">Home</div> <!-- Хуудасны нэрийг харуулах хэсэг -->
</header>

<!-- Sidebar -->
<div id="sidebar">
  <span class="close-btn" onclick="toggleSidebar()">×</span>
  <ul>
    <li onclick="showPage('addressPage')"><img src="assets/hayg.png" alt="Хаяг" style="width:24px; height:24px;">Хаяг</li>
    <li onclick="showPage('homePage')">Home</li>
    <li onclick="showPage('bestSellerPage')">Best Seller</li>
    <li onclick="showPage('hoodiePage')">Hoodie</li>
    <li onclick="showPage('sweaterPage')">Sweater</li>
    <li onclick="showPage('pantsPage')">Pants</li>
    <li onclick="showPage('accessoriesPage')">Accessories</li>
  </ul>
</div>

<!-- Home Page -->
<div id="homePage" class="page active">
  <div class="products">
    <div class="product">
      <img src="assets/baraa1.png" alt="Baraa1">
      <div class="price">₮121,000 <span class="old-price">₮149,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa1.png','₮121,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa1.png','121000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa2.png" alt="Baraa2">
      <div class="price">₮177,000 <span class="old-price">₮210,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa2.png','₮177,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa2.png','177000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa3.png" alt="Baraa3">
      <div class="price">₮153,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa3.png','₮153,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa3.png','153000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa4.png" alt="Baraa4">
      <div class="price">₮154,000 <span class="old-price">₮214,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa4.png','₮154,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa4.png','154000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa5.png" alt="Baraa5">
      <div class="price">₮151,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa5.png','₮151,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa5.png','151000')">Захиалах</button>
      </div>
    </div>
  </div>
</div>

<!-- Best Seller Page -->
<div id="bestSellerPage" class="page">
  <div class="products">
    <div class="product">
      <img src="assets/baraa1.png" alt="Baraa1">
      <div class="price">₮121,000 <span class="old-price">₮149,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa1.png','₮121,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa1.png','121000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa2.png" alt="Baraa2">
      <div class="price">₮177,000 <span class="old-price">₮210,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa2.png','₮177,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa2.png','177000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa3.png" alt="Baraa3">
      <div class="price">₮153,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa3.png','₮153,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa3.png','153000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa4.png" alt="Baraa4">
      <div class="price">₮154,000 <span class="old-price">₮214,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa4.png','₮154,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa4.png','154000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa5.png" alt="Baraa5">
      <div class="price">₮151,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa5.png','₮151,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa5.png','151000')">Захиалах</button>
      </div>
    </div>
  </div>
</div>

<!-- Hoodie Page -->
<div id="hoodiePage" class="page">
  <div class="products">
    <div class="product">
      <img src="assets/baraa1.png" alt="Baraa1">
      <div class="price">₮121,000 <span class="old-price">₮149,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa1.png','₮121,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa1.png','121000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa2.png" alt="Baraa2">
      <div class="price">₮177,000 <span class="old-price">₮210,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa2.png','₮177,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa2.png','177000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa3.png" alt="Baraa3">
      <div class="price">₮153,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa3.png','₮153,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa3.png','153000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa4.png" alt="Baraa4">
      <div class="price">₮154,000 <span class="old-price">₮214,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa4.png','₮154,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa4.png','154000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa5.png" alt="Baraa5">
      <div class="price">₮151,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa5.png','₮151,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa5.png','151000')">Захиалах</button>
      </div>
    </div>
  </div>
</div>

<!-- Sweater Page -->
<div id="sweaterPage" class="page">
  <div class="products">
    <div class="product">
      <img src="assets/baraa1.png" alt="Baraa1">
      <div class="price">₮121,000 <span class="old-price">₮149,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa1.png','₮121,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa1.png','121000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa2.png" alt="Baraa2">
      <div class="price">₮177,000 <span class="old-price">₮210,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa2.png','₮177,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa2.png','177000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa3.png" alt="Baraa3">
      <div class="price">₮153,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa3.png','₮153,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa3.png','153000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa4.png" alt="Baraa4">
      <div class="price">₮154,000 <span class="old-price">₮214,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa4.png','₮154,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa4.png','154000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa5.png" alt="Baraa5">
      <div class="price">₮151,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa5.png','₮151,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa5.png','151000')">Захиалах</button>
      </div>
    </div>
  </div>
</div>

<!-- Pants Page -->
<div id="pantsPage" class="page">
  <div class="products">
    <div class="product">
      <img src="assets/baraa1.png" alt="Baraa1">
      <div class="price">₮121,000 <span class="old-price">₮149,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa1.png','₮121,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa1.png','121000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa2.png" alt="Baraa2">
      <div class="price">₮177,000 <span class="old-price">₮210,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa2.png','₮177,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa2.png','177000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa3.png" alt="Baraa3">
      <div class="price">₮153,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa3.png','₮153,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa3.png','153000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa4.png" alt="Baraa4">
      <div class="price">₮154,000 <span class="old-price">₮214,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa4.png','₮154,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa4.png','154000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa5.png" alt="Baraa5">
      <div class="price">₮151,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa5.png','₮151,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa5.png','151000')">Захиалах</button>
      </div>
    </div>
  </div>
</div>

<!-- Accessories Page -->
<div id="accessoriesPage" class="page">
  <div class="products">
    <div class="product">
      <img src="assets/baraa1.png" alt="Baraa1">
      <div class="price">₮121,000 <span class="old-price">₮149,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa1.png','₮121,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa1.png','121000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa2.png" alt="Baraa2">
      <div class="price">₮177,000 <span class="old-price">₮210,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa2.png','₮177,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa2.png','177000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa3.png" alt="Baraa3">
      <div class="price">₮153,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa3.png','₮153,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa3.png','153000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa4.png" alt="Baraa4">
      <div class="price">₮154,000 <span class="old-price">₮214,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa4.png','₮154,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa4.png','154000')">Захиалах</button>
      </div>
    </div>
    <div class="product">
      <img src="assets/baraa5.png" alt="Baraa5">
      <div class="price">₮151,000 <span class="old-price">₮185,000</span></div>
      <div class="product-panel">
        <button onclick="event.stopPropagation(); addToCart('assets/baraa5.png','₮151,000')">Сагсанд нэмэх</button>
        <button onclick="event.stopPropagation(); openOrder('assets/baraa5.png','151000')">Захиалах</button>
      </div>
    </div>
  </div>
</div>

<!-- Cart Page -->
<div id="cartPage" class="page cart-page">
  <div id="cartItems"></div>
  <div class="cart-empty" id="cartEmpty">Сагс хоосон байна</div>
  <button onclick="backToShop()">⇦ Дэлгүүр рүү буцах</button>
</div>

<!-- Address Page -->
<div id="addressPage" class="page">
  <div class="address-form-container">
    <img src="assets/hayg.png" alt="Хаяг" style="display: block; margin: 0 auto 20px; width: 80px;">
    <h2>Хүргэлтийн хаяг</h2>
    <form id="addressForm">
      <div class="form-group">
        <label for="fullName">Бүтэн нэр:</label>
        <input type="text" id="fullName" required>
      </div>
      <div class="form-group">
        <label for="phoneNumber">Утасны дугаар:</label>
        <input type="tel" id="phoneNumber" required>
      </div>
      <div class="form-group">
        <label for="province">Аймаг/Хот:</label>
        <input type="text" id="province" required>
      </div>
      <div class="form-group">
        <label for="district">Сум/Дүүрэг:</label>
        <input type="text" id="district" required>
      </div>
      <div class="form-group">
        <label for="khoroo">Баг/Хороо:</label>
        <input type="text" id="khoroo" required>
      </div>
      <div class="form-group">
        <label for="street">Гудамж/Байрны нэр:</label>
        <input type="text" id="street" required>
      </div>
      <div class="form-group">
        <label for="apartment">Хаалга/Орцны дугаар:</label>
        <input type="text" id="apartment">
      </div>
      <button type="submit">Хаягийг хадгалах</button>
    </form>
  </div>
</div>

<!-- Notification -->
<div id="notify"></div>

<!-- Code Modal -->
<div id="codeModal">
  <div class="code-modal-content">
    <h3>Захиалга</h3>
    <p>Доорх кодыг ашиглан төлбөрөө хийнэ үү</p>
    <p id="paymentCode"></p>
    <button onclick="closeCodeModal()">Хаах</button>
  </div>
</div>

<script>
// Declare db globally
let db; 
let cart = JSON.parse(localStorage.getItem("cart")) || [];

// Firebase configuration - Таны өгсөн тохиргоо
const firebaseConfig = {
  apiKey: "AIzaSyAEybA-Ou_PGkZINDT-opzVPUlrr6XOU8E",
  authDomain: "khalkh-store.firebaseapp.com",
  databaseURL: "https://khalkh-store-default-rtdb.firebaseio.com", // Realtime Database-д чухал
  projectId: "khalkh-store",
  storageBucket: "khalkh-store.firebasestorage.app",
  messagingSenderId: "205879441792",
  appId: "1:205879441792:web:677a6abe7912d6436a2965",
  measurementId: "G-6M9HZM8G9N"
};

// Initialize Firebase and Realtime Database using v8 namespaced syntax
document.addEventListener('DOMContentLoaded', () => {
  console.log("DOMContentLoaded fired. Attempting Firebase initialization...");
  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
    console.log("Firebase app initialized.");
  } else {
    console.log("Firebase app already initialized.");
  }
  firebase.analytics(); // Initialize Analytics
  db = firebase.database(); // Realtime Database-ийг эхлүүлж байна
  console.log("Realtime Database instance (db) assigned:", db); // Check if db is an object

  // Initial render of the cart when the page loads
  renderCart();
  updateCartCount(); // Сагсны тоог шинэчлэх

  // Address form submit event listener
  const addressForm = document.getElementById('addressForm');
  if (addressForm) {
    // Local Storage-оос хаягийн мэдээллийг уншиж формыг бөглөх
    const savedAddress = localStorage.getItem("userAddress");
    if (savedAddress) {
      const addressData = JSON.parse(savedAddress);
      document.getElementById('fullName').value = addressData.fullName || '';
      document.getElementById('phoneNumber').value = addressData.phoneNumber || '';
      document.getElementById('province').value = addressData.province || '';
      document.getElementById('district').value = addressData.district || '';
      document.getElementById('khoroo').value = addressData.khoroo || '';
      document.getElementById('street').value = addressData.street || '';
      document.getElementById('apartment').value = addressData.apartment || '';
    }

    addressForm.addEventListener('submit', async (e) => {
      e.preventDefault(); // Prevent default form submission

      const addressData = {
        fullName: document.getElementById('fullName').value,
        phoneNumber: document.getElementById('phoneNumber').value,
        province: document.getElementById('province').value,
        district: document.getElementById('district').value,
        khoroo: document.getElementById('khoroo').value,
        street: document.getElementById('street').value,
        apartment: document.getElementById('apartment').value
      };

      // Хаягийн мэдээллийг Local Storage-д хадгалах
      localStorage.setItem("userAddress", JSON.stringify(addressData));
      renderNotification("Хаяг амжилттай хадгалагдлаа!");
      console.log("Address saved to Local Storage.");
      // Forms-ийг цэвэрлэхгүй, учир нь дараагийн удаа нээхэд бөглөгдсөн байх ёстой.
    });
  }
});


// Show page
function showPage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
  const sidebar = document.getElementById('sidebar');
  if (sidebar.classList.contains('active')) {
    toggleSidebar();
  }
  updateCurrentPageDisplay(pageId); // Хуудасны нэрийг шинэчлэх
}

// Хуудасны нэрийг харуулах функцийг шинэчлэх
function updateCurrentPageDisplay(pageId) {
  const displayElement = document.getElementById('current-page-display');
  let pageName = '';
  switch (pageId) {
    case 'homePage':
      pageName = 'Home';
      break;
    case 'addressPage':
      pageName = 'Хаяг';
      break;
    case 'bestSellerPage':
      pageName = 'Best Seller';
      break;
    case 'hoodiePage':
      pageName = 'Hoodie';
      break;
    case 'sweaterPage':
      pageName = 'Sweater';
      break;
    case 'pantsPage':
      pageName = 'Pants';
      break;
    case 'accessoriesPage':
      pageName = 'Accessories';
      break;
    case 'cartPage':
      pageName = 'Сагс';
      break;
    default:
      pageName = 'Home';
  }
  displayElement.innerText = pageName;
}


// Cart page
function openCart() {
  showPage('cartPage');
  renderCart(); // Ensure cart is rendered when opened
}

function backToShop() {
  showPage('homePage');
}

// Toggle sidebar
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  if (sidebar.classList.contains('active')) {
    sidebar.style.animation = 'sidebarOut 0.3s forwards';
    setTimeout(() => { sidebar.classList.remove('active'); }, 300);
  } else {
    sidebar.classList.add('active');
    sidebar.style.animation = 'sidebarIn 0.3s forwards';
  }
}

// Add to cart with scale effect
function addToCart(img, price) {
  const productEl = document.querySelector(`.product img[src="${img}"]`).parentElement;
  productEl.style.transform = 'scale(1.05)';
  setTimeout(() => { productEl.style.transform = 'scale(1)'; }, 300);

  // Барааг сагсанд нэмэх
  cart.push({ img, price });
  localStorage.setItem("cart", JSON.stringify(cart));
  renderNotification("Бараа сагсанд нэмэгдлээ!");
  renderCart(); // Ensure cart is rendered after adding an item
  updateCartCount(); // Сагсны тоог шинэчлэх
}

// Сагсны тоог шинэчлэх функц
function updateCartCount() {
  const cartCountElement = document.getElementById('cartCount');
  if (cart.length > 0) {
    cartCountElement.innerText = cart.length;
    cartCountElement.style.display = 'block';
  } else {
    cartCountElement.style.display = 'none';
  }
}

// Render cart
function renderCart() {
  const container = document.getElementById("cartItems");
  const empty = document.getElementById("cartEmpty");
  container.innerHTML = "";

  if (cart.length === 0) {
    empty.style.display = "block";
    return;
  }

empty.style.display = "none";

  cart.forEach((item, index) => {
    const div = document.createElement("div");
    div.className = "cart-item";
    div.innerHTML = `<img src="${item.img}"><div>${item.price}</div>
    <img src="assets/delete.png" class="delete-btn" onclick="deleteItem(${index})">`;
    container.appendChild(div);
  });
}

// Delete item
function deleteItem(index) {
  cart.splice(index, 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart(); // Ensure cart is rendered after deleting an item
  updateCartCount(); // Сагсны тоог шинэчлэх
}

// Notification animation
function renderNotification(msg) {
  const notify = document.getElementById("notify");
  notify.innerText = msg;
  notify.style.display = "block";
  notify.style.animation = "notifyIn 0.3s forwards";
  setTimeout(() => { notify.style.animation = "notifyOut 0.3s forwards"; }, 1500);
  setTimeout(() => { notify.style.display = "none"; }, 1800);
}

// Generate unique code for Realtime Database
async function generateUniqueCode() {
  if (!db) {
    console.error("Realtime Database is not initialized. Cannot generate unique code.");
    throw new Error("Realtime Database is not initialized. Please check Firebase setup.");
  }
  
  const newOrderRef = db.ref('paymentCodes').push();
  const uniqueCode = newOrderRef.key;
  console.log("Unique code generated (Realtime DB):", uniqueCode);
  return uniqueCode;
}

// Save order to Realtime Database and show in modal
async function openOrder(img, amount) {
  const modal = document.getElementById("codeModal");
  const codeDisplay = document.getElementById("paymentCode");
  codeDisplay.innerText = "Кодыг үүсгэж байна..."; // Show loading message
  modal.style.display = "flex"; // Show the modal

  try {
    if (!db) {
      throw new Error("Realtime Database is not initialized.");
    }

    const uniqueCode = await generateUniqueCode();

    if (!uniqueCode) {
      throw new Error("Failed to generate unique code.");
    }

    // Local Storage-оос хаягийн мэдээллийг унших
    const savedAddress = localStorage.getItem("userAddress");
    let addressData = {};
    if (savedAddress) {
      addressData = JSON.parse(savedAddress);
    } else {
      renderNotification("Захиалга хийхийн өмнө хаягаа бөглөнө үү!");
      closeCodeModal(); // Модалыг хаах
      showPage('addressPage'); // Хаягийн хуудас руу шилжүүлэх
      return; // Цааш үргэлжлүүлэхгүй
    }

    // Realtime Database руу мэдээлэл хадгалах (хаягийн мэдээлэлтэй хамт)
    await db.ref('paymentCodes/' + uniqueCode).set({
      image: img,
      amount: parseFloat(amount),
      address: addressData, // Хаягийн мэдээллийг нэмсэн
      createdAt: firebase.database.ServerValue.TIMESTAMP
    });
    
    codeDisplay.innerText = uniqueCode; // Display the generated code
    renderNotification("Захиалга амжилттай үүслээ!");
    console.log("Order saved to Realtime Database with code:", uniqueCode);
  } catch (error) {
    codeDisplay.innerText = "Алдаа гарлаа: " + error.message; // Display error message
    console.error("Error generating or saving order code to Realtime Database:", error);
    renderNotification("Захиалга үүсгэхэд алдаа гарлаа!");
  }
}

// Close code modal
function closeCodeModal() {
  document.getElementById("codeModal").style.display = "none";
}
</script>

</body>
</html>
